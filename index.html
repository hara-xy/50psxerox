<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50psxerox - Xerox Printing Service</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üñ®Ô∏è</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        .dark body {
            background-color: #0f172a;
        }
        .file-upload-wrapper {
            position: relative;
            width: 100%;
            height: 200px;
        }
        .file-upload-wrapper input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }
        .file-upload-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .file-upload-wrapper:hover .file-upload-content {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .dark .file-upload-content {
            border-color: #475569;
        }
        .dark .file-upload-wrapper:hover .file-upload-content {
            border-color: #3b82f6;
            background-color: #1e293b;
        }
        .print-preview {
            transition: transform 0.3s ease;
        }
        .print-preview:hover {
            transform: scale(1.02);
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        #documentPreviewImage {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
        }
        .file-icon {
            font-size: 80px;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-slate-900 text-gray-900 dark:text-white transition-colors duration-300">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-slate-800 shadow-md py-4 px-6 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <i data-feather="printer" class="text-primary w-8 h-8"></i>
            <h1 class="text-2xl font-bold">50<span class="text-primary">psxerox</span></h1>
        </div>
        <div class="flex items-center space-x-4">
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                <i data-feather="moon" class="w-5 h-5"></i>
            </button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="py-12 px-4 md:px-8 max-w-6xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">50psxerox - Professional Xerox Printing</h1>
            <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                High-quality Xerox printing services with fast turnaround. Affordable rates and reliable delivery.
            </p>
        </div>

        <!-- Upload Section -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 md:p-8 max-w-4xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- File Upload Area -->
                <div>
                    <h2 class="text-2xl font-semibold mb-6">Upload Your Documents</h2>
                    <div class="file-upload-wrapper mb-6">
                        <input type="file" id="file-upload" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        <div class="file-upload-content">
                            <i data-feather="upload-cloud" class="w-12 h-12 text-gray-400 mb-3"></i>
                            <p class="text-gray-500 dark:text-gray-400 mb-2">Drag & drop files here</p>
                            <p class="text-sm text-gray-400 dark:text-gray-500">or click to browse</p>
                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">Supports PDF, DOC, JPG, PNG</p>
                        </div>
                    </div>

                    <!-- Upload Progress Bar -->
                    <div id="uploadProgress" class="mb-6 hidden">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Uploading...</span>
                            <span id="uploadPercent" class="text-sm font-medium text-primary">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2.5">
                            <div id="uploadProgressBar" class="progress-bar bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2">Print Options</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Copies</label>
                                <select id="copiesSelect" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>5</option>
                                    <option>10</option>
                                    <option>20</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Color</label>
                                <select id="colorSelect" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700">
                                    <option>Black & White</option>
                                    <option>Color</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 mb-2">Paper Size</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button class="paper-size-btn p-3 border-2 border-gray-300 dark:border-slate-600 rounded-lg text-center hover:bg-gray-100 dark:hover:bg-slate-700 transition" data-size="A4">A4</button>
                            <button class="paper-size-btn p-3 border-2 border-gray-300 dark:border-slate-600 rounded-lg text-center hover:bg-gray-100 dark:hover:bg-slate-700 transition" data-size="A3">A3</button>
                            <button class="paper-size-btn p-3 border-2 border-gray-300 dark:border-slate-600 rounded-lg text-center hover:bg-gray-100 dark:hover:bg-slate-700 transition" data-size="Letter">Letter</button>
                        </div>
                    </div>

                    <!-- Modal for collecting user information -->
                    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 w-full max-w-md mx-4">
                            <h3 class="text-xl font-semibold mb-4">Complete Your Order</h3>
                            <form id="checkoutForm" class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-1">Name</label>
                                    <input type="text" id="userName" required class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                    <input type="email" id="userEmail" required class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700">
                                </div>
                                
                                <!-- Order Progress Bar -->
                                <div id="orderProgress" class="hidden">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300" id="orderProgressText">Processing...</span>
                                        <span id="orderPercent" class="text-sm font-medium text-primary">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2.5">
                                        <div id="orderProgressBar" class="progress-bar bg-secondary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>

                                <div class="flex space-x-3 pt-2">
                                    <button type="submit" id="confirmOrderBtn" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition flex items-center justify-center">
                                        <span>Confirm Order</span>
                                    </button>
                                    <button type="button" id="cancelCheckout" class="flex-1 bg-gray-300 dark:bg-slate-600 text-gray-800 dark:text-white py-3 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-slate-500 transition">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <button id="proceedToCheckout" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition flex items-center justify-center">
                        <i data-feather="send" class="mr-2"></i>
                        Proceed to Checkout
                    </button>
                </div>

                <!-- Preview Section -->
                <div>
                    <h2 class="text-2xl font-semibold mb-6">Print Preview</h2>
                    <div class="bg-gray-100 dark:bg-slate-700 rounded-xl p-6 h-full flex flex-col">
                        <div class="flex-1 mb-6">
                            <div class="print-preview bg-white dark:bg-slate-600 rounded-lg shadow-md p-4 mb-4">
                                <div class="flex items-center mb-3">
                                    <i data-feather="file-text" class="w-5 h-5 text-primary mr-2"></i>
                                    <h3 class="font-medium">Document Preview</h3>
                                </div>
                                <div id="documentPreviewContainer" class="border border-gray-200 dark:border-slate-500 rounded min-h-60 flex items-center justify-center text-gray-500 dark:text-gray-400 p-4">
                                    <p id="previewPlaceholder">No document selected</p>
                                    <img id="documentPreviewImage" class="hidden rounded" alt="Document preview">
                                    <div id="documentPreviewIcon" class="hidden flex flex-col items-center">
                                        <div class="file-icon mb-3"></div>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Document ready to print</p>
                                    </div>
                                </div>
                                <div class="mt-4 text-sm text-gray-500 dark:text-gray-400">
                                    <p><span class="font-medium">File:</span> <span id="file-name">-</span></p>
                                    <p><span class="font-medium">Pages:</span> <span id="page-count">0</span></p>
                                    <p><span class="font-medium">Size:</span> <span id="file-size">0 KB</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="module">
        import { sendWorkflowToTelegram } from './TelegramService.js';

        // Initialize feather icons
        feather.replace();

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        if (savedTheme === 'dark') {
            body.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            localStorage.setItem('theme', body.classList.contains('dark') ? 'dark' : 'light');
            
            const icon = themeToggle.querySelector('i');
            icon.setAttribute('data-feather', body.classList.contains('dark') ? 'sun' : 'moon');
            feather.replace();
        });

        // File upload handling
        const fileUpload = document.getElementById('file-upload');
        const fileName = document.getElementById('file-name');
        const pageCount = document.getElementById('page-count');
        const fileSize = document.getElementById('file-size');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const uploadPercent = document.getElementById('uploadPercent');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const documentPreviewImage = document.getElementById('documentPreviewImage');
        const documentPreviewIcon = document.getElementById('documentPreviewIcon');
        let uploadedFile = null;

        // Function to get file icon based on type
        function getFileIcon(fileType) {
            if (fileType.includes('pdf')) {
                return 'üìÑ';
            } else if (fileType.includes('word') || fileType.includes('document')) {
                return 'üìù';
            } else if (fileType.includes('image')) {
                return 'üñºÔ∏è';
            } else {
                return 'üìé';
            }
        }

        // Simulate upload progress
        function simulateUploadProgress() {
            uploadProgress.classList.remove('hidden');
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                uploadProgressBar.style.width = progress + '%';
                uploadPercent.textContent = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadProgress.classList.add('hidden');
                        uploadProgressBar.style.width = '0%';
                    }, 500);
                }
            }, 100);
        }

        fileUpload.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                uploadedFile = file;
                
                // Show upload progress
                simulateUploadProgress();
                
                // Update file info
                fileName.textContent = file.name;
                fileSize.textContent = (file.size / 1024).toFixed(0) + ' KB';
                pageCount.textContent = Math.floor(Math.random() * 10) + 1;
                
                // Hide placeholder
                previewPlaceholder.classList.add('hidden');
                
                // Show preview based on file type
                if (file.type.startsWith('image/')) {
                    // Show image preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        documentPreviewImage.src = e.target.result;
                        documentPreviewImage.classList.remove('hidden');
                        documentPreviewIcon.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Show file icon for PDF/DOC
                    documentPreviewImage.classList.add('hidden');
                    documentPreviewIcon.classList.remove('hidden');
                    const iconElement = documentPreviewIcon.querySelector('.file-icon');
                    iconElement.textContent = getFileIcon(file.type);
                }
            }
        });

        // Paper size selection
        const paperSizeBtns = document.querySelectorAll('.paper-size-btn');
        let selectedPaperSize = 'A4';

        paperSizeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                paperSizeBtns.forEach(b => {
                    b.classList.remove('border-primary', 'bg-blue-50', 'dark:bg-slate-600');
                    b.classList.add('border-gray-300', 'dark:border-slate-600');
                });
                btn.classList.remove('border-gray-300', 'dark:border-slate-600');
                btn.classList.add('border-primary', 'bg-blue-50', 'dark:bg-slate-600');
                selectedPaperSize = btn.dataset.size;
            });
        });

        // Set default selection
        paperSizeBtns[0].click();

        // Checkout modal functionality
        const proceedToCheckout = document.getElementById('proceedToCheckout');
        const checkoutModal = document.getElementById('checkoutModal');
        const checkoutForm = document.getElementById('checkoutForm');
        const cancelCheckout = document.getElementById('cancelCheckout');
        const userNameInput = document.getElementById('userName');
        const userEmailInput = document.getElementById('userEmail');
        const confirmOrderBtn = document.getElementById('confirmOrderBtn');
        const orderProgress = document.getElementById('orderProgress');
        const orderProgressBar = document.getElementById('orderProgressBar');
        const orderPercent = document.getElementById('orderPercent');
        const orderProgressText = document.getElementById('orderProgressText');

        proceedToCheckout.addEventListener('click', () => {
            if (!uploadedFile) {
                alert('Please upload a document first!');
                return;
            }
            checkoutModal.classList.remove('hidden');
        });

        cancelCheckout.addEventListener('click', () => {
            checkoutModal.classList.add('hidden');
        });

        // Progress stages
        const progressStages = [
            { percent: 20, text: 'Preparing order...' },
            { percent: 40, text: 'Sending message...' },
            { percent: 60, text: 'Uploading summary...' },
            { percent: 80, text: 'Uploading document...' },
            { percent: 100, text: 'Complete!' }
        ];

        async function updateProgress(stage) {
            const { percent, text } = progressStages[stage];
            orderProgressBar.style.width = percent + '%';
            orderPercent.textContent = percent + '%';
            orderProgressText.textContent = text;
            await new Promise(resolve => setTimeout(resolve, 300));
        }

        checkoutForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = userNameInput.value.trim();
            const email = userEmailInput.value.trim();
            
            if (!name || !email) {
                alert('Please fill in all fields');
                return;
            }

            if (!uploadedFile) {
                alert('Please upload a document first!');
                return;
            }

            // Show progress bar and disable button
            orderProgress.classList.remove('hidden');
            confirmOrderBtn.disabled = true;
            confirmOrderBtn.innerHTML = '<i data-feather="loader" class="animate-spin mr-2"></i><span>Processing...</span>';
            feather.replace();

            try {
                // Stage 0: Preparing
                await updateProgress(0);

                const workflowData = {
                    nodes: [],
                    edges: [],
                    groups: []
                };
                
                workflowData.nodes.push({
                    id: 'document-1',
                    type: 'document',
                    data: {
                        label: fileName.textContent,
                        size: fileSize.textContent,
                        pages: pageCount.textContent
                    },
                    file: uploadedFile
                });
                
                const copiesSelect = document.getElementById('copiesSelect');
                const colorSelect = document.getElementById('colorSelect');
                
                workflowData.nodes.push({
                    id: 'print-options',
                    type: 'print-options',
                    data: {
                        copies: copiesSelect.value,
                        color: colorSelect.value,
                        paperSize: selectedPaperSize
                    }
                });

                // Update progress through stages
                for (let i = 1; i < progressStages.length; i++) {
                    await updateProgress(i);
                }

                const success = await sendWorkflowToTelegram(
                    name,
                    email,
                    workflowData.nodes,
                    workflowData.edges,
                    workflowData.groups
                );
                
                if (success) {
                    await updateProgress(4); // Complete
                    alert('Your order has been submitted successfully! We will contact you shortly.');
                    checkoutModal.classList.add('hidden');
                    checkoutForm.reset();
                    fileName.textContent = '-';
                    pageCount.textContent = '0';
                    fileSize.textContent = '0 KB';
                    previewPlaceholder.classList.remove('hidden');
                    documentPreviewImage.classList.add('hidden');
                    documentPreviewIcon.classList.add('hidden');
                    uploadedFile = null;
                    fileUpload.value = '';
                } else {
                    alert('There was an error submitting your order. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error submitting your order. Please try again.');
            } finally {
                // Reset button and progress
                orderProgress.classList.add('hidden');
                orderProgressBar.style.width = '0%';
                confirmOrderBtn.disabled = false;
                confirmOrderBtn.innerHTML = '<span>Confirm Order</span>';
            }
        });
    </script>
</body>
</html>